{% extends "base.html" %}

{% block title %}Meine Bestellungen - Gourmen{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m3 5 2 14h14l2-14H3Z"/>
                <path d="M16 11a4 4 0 0 1-8 0"/>
            </svg>
            Meine Bestellungen
        </h1>
        <p class="page-subtitle">Übersicht aller deiner Merch-Bestellungen</p>
        <div class="page-actions">
            <a href="{{ url_for('member.merch') }}" class="btn btn--outline">Zurück zum Shop</a>
            <a href="{{ url_for('member.merch_order') }}" class="btn btn--primary">Neue Bestellung</a>
        </div>
    </div>
    
    <div class="page-content">
        {% if orders %}
            {% for order in orders %}
            <div class="card">
                <div class="card__header">
                    <h2 class="card__title">Bestellung #{{ order.order_number }}</h2>
                    <div class="order-status">
                        <span class="status-badge">
                            {{ order.status_display }}
                        </span>
                    </div>
                </div>
                <div class="card__body">
                    <div class="order-info">
                        <div class="info-row">
                            <span class="info-row__label">Bestellt am</span>
                            <span class="info-row__value">{{ order.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-row__label">Gesamtbetrag</span>
                            <span class="info-row__value">{{ "%.2f"|format(order.total_member_price_chf) }} CHF</span>
                        </div>
                        <div class="info-row">
                            <span class="info-row__label">Anzahl Artikel</span>
                            <span class="info-row__value">{{ order.get_item_count() }} Stück</span>
                        </div>
                        <div class="info-row">
                            <span class="info-row__label">Einzigartige Artikel</span>
                            <span class="info-row__value">{{ order.get_unique_articles_count() }} verschiedene</span>
                        </div>
                        {% if order.delivered_at %}
                        <div class="info-row">
                            <span class="info-row__label">Geliefert am</span>
                            <span class="info-row__value">{{ order.delivered_at.strftime('%d.%m.%Y %H:%M') }}</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Bestellpositionen -->
                    <div class="order-items">
                        <h4>Bestellte Artikel:</h4>
                        {% for item in order.order_items %}
                        <div class="card">
                            <div class="card__header">
                                <h5 class="card__title">{{ item.display_name }}</h5>
                            </div>
                            <div class="card__body">
                                <div class="info-row">
                                    <span class="info-row__label">Anzahl</span>
                                    <span class="info-row__value">{{ item.quantity }}x</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-row__label">Einzelpreis</span>
                                    <span class="info-row__value">{{ "%.2f"|format(item.unit_member_price_chf) }} CHF</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-row__label">Gesamtpreis</span>
                                    <span class="info-row__value">{{ "%.2f"|format(item.total_member_price_chf) }} CHF</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                </div>
                <div class="card__footer">
                    <a href="{{ url_for('member.merch_order_detail', order_id=order.id) }}" class="btn btn--primary">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        Details anzeigen
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="card">
                <div class="card__header">
                    <h2 class="card__title">Keine Bestellungen</h2>
                </div>
                <div class="card__body">
                    <p>Du hast noch keine Merch-Bestellungen aufgegeben.</p>
                </div>
                <div class="card__footer">
                    <a href="{{ url_for('member.merch_order') }}" class="btn btn--primary">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                            <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                            <path d="M4 22h16"/>
                            <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
                            <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                            <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
                        </svg>
                        Erste Bestellung aufgeben
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

