{% extends "base.html" %}

{% block title %}Profil - Gourmen{% endblock %}

{% block content %}
<div class="container">
    <!-- Breadcrumbs -->
    <nav class="breadcrumbs" aria-label="Breadcrumb">
        <div class="breadcrumbs__item">
            <a href="{{ url_for('member.index') }}" class="breadcrumbs__link">Member</a>
            <span class="breadcrumbs__separator">/</span>
        </div>
        <div class="breadcrumbs__item">
            <span class="breadcrumbs__current">Profil</span>
        </div>
    </nav>

    <div class="page-header">
        <h1>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="8" r="3"/>
                <path d="M6.168 18.849A4 4 0 0 1 10 16h4a4 4 0 0 1 3.834 2.855"/>
            </svg>
            Mein Profil
        </h1>
        <p class="page-subtitle">Verwalte deine persönlichen Daten und Einstellungen</p>
    </div>
    
    <div class="page-content">
        <!-- Tabs Navigation -->
        <div class="tabs">
            <nav class="tabs__nav" role="tablist">
                <a href="{{ url_for('member.profile', tab='profile') }}"
                   class="tabs__tab {{ 'tabs__tab--active' if active_tab == 'profile' else '' }}"
                   role="tab">
                    Profildaten
                </a>
                <a href="{{ url_for('member.profile', tab='sensitive') }}"
                   class="tabs__tab {{ 'tabs__tab--active' if active_tab == 'sensitive' else '' }}"
                   role="tab">
                    {% if has_step_up %}
                    <!-- Unlocked Icon wenn Step-Up aktiv -->
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 0 10 0v4"/>
                    </svg>
                    {% else %}
                    <!-- Locked Icon wenn Step-Up nötig -->
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    {% endif %}
                    Sensible Daten
                </a>
            </nav>
            
            <div class="tabs__content">
                <!-- Tab 1: Profildaten -->
                <div class="tabs__panel {{ 'tabs__panel--active' if active_tab == 'profile' else '' }}"
                     role="tabpanel">
        <form method="POST" class="form">
            {{ form.hidden_tag() }}
            <input type="hidden" name="active_tab" value="profile">
            
            <!-- Personal Data Card -->
            <div class="card">
                <div class="card__header">
                    <h2 class="card__title">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Persönliche Daten
                    </h2>
                </div>
                <div class="card__body">
                            <div class="form-row">
                                <div class="form-field">
                                    {{ form.vorname.label(class="form-field__label") }}
                                    {{ form.vorname(class="form-field__input") }}
                                    {% if form.vorname.errors %}
                                    <span class="form-field__error">{{ form.vorname.errors[0] }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="form-field">
                                    {{ form.nachname.label(class="form-field__label") }}
                                    {{ form.nachname(class="form-field__input") }}
                                    {% if form.nachname.errors %}
                                    <span class="form-field__error">{{ form.nachname.errors[0] }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-field">
                                    {{ form.rufname.label(class="form-field__label") }}
                                    {{ form.rufname(class="form-field__input") }}
                                    {% if form.rufname.errors %}
                                    <span class="form-field__error">{{ form.rufname.errors[0] }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="form-field">
                                    {{ form.email.label(class="form-field__label") }}
                                    {{ form.email(class="form-field__input") }}
                                    {% if form.email.errors %}
                                    <span class="form-field__error">{{ form.email.errors[0] }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-field">
                                    {{ form.telefon.label(class="form-field__label") }}
                                    {{ form.telefon(class="form-field__input") }}
                                    {% if form.telefon.errors %}
                                    <span class="form-field__error">{{ form.telefon.errors[0] }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="form-field">
                                    {{ form.geburtsdatum.label(class="form-field__label") }}
                                    {{ form.geburtsdatum(class="form-field__input", type="date") }}
                                    {% if form.geburtsdatum.errors %}
                                    <span class="form-field__error">{{ form.geburtsdatum.errors[0] }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-field">
                                {{ form.nationalitaet.label(class="form-field__label") }}
                                {{ form.nationalitaet(class="form-field__select") }}
                                {% if form.nationalitaet.errors %}
                                <span class="form-field__error">{{ form.nationalitaet.errors[0] }}</span>
                                {% endif %}
                            </div>
                            
                            <div class="form-field">
                                {{ form.zimmerwunsch.label(class="form-field__label") }}
                                {{ form.zimmerwunsch(class="form-field__select") }}
                                {% if form.zimmerwunsch.errors %}
                                <span class="form-field__error">{{ form.zimmerwunsch.errors[0] }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Address Card -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                                Adresse
                            </h2>
                        </div>
                        <div class="card__body">
                            <div class="form-row">
                                <div class="form-field">
                                    {{ form.strasse.label(class="form-field__label") }}
                                    {{ form.strasse(class="form-field__input") }}
                                    {% if form.strasse.errors %}
                                    <span class="form-field__error">{{ form.strasse.errors[0] }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="form-field">
                                    {{ form.hausnummer.label(class="form-field__label") }}
                                    {{ form.hausnummer(class="form-field__input") }}
                                    {% if form.hausnummer.errors %}
                                    <span class="form-field__error">{{ form.hausnummer.errors[0] }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-field">
                                    {{ form.plz.label(class="form-field__label") }}
                                    {{ form.plz(class="form-field__input") }}
                                    {% if form.plz.errors %}
                                    <span class="form-field__error">{{ form.plz.errors[0] }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="form-field">
                                    {{ form.ort.label(class="form-field__label") }}
                                    {{ form.ort(class="form-field__input") }}
                                    {% if form.ort.errors %}
                                    <span class="form-field__error">{{ form.ort.errors[0] }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Physical Data Card -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                                </svg>
                                Körperliche Daten
                            </h2>
                        </div>
                        <div class="card__body">
                            <div class="form-row">
                                <div class="form-field">
                                    {{ form.koerpergroesse.label(class="form-field__label") }}
                                    {{ form.koerpergroesse(class="form-field__input") }}
                                    {% if form.koerpergroesse.errors %}
                                    <span class="form-field__error">{{ form.koerpergroesse.errors[0] }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="form-field">
                                    {{ form.koerpergewicht.label(class="form-field__label") }}
                                    {{ form.koerpergewicht(class="form-field__input") }}
                                    {% if form.koerpergewicht.errors %}
                                    <span class="form-field__error">{{ form.koerpergewicht.errors[0] }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-field">
                                {{ form.schuhgroesse.label(class="form-field__label") }}
                                {{ form.schuhgroesse(class="form-field__input") }}
                                {% if form.schuhgroesse.errors %}
                                <span class="form-field__error">{{ form.schuhgroesse.errors[0] }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Clothing Card -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"/>
                                </svg>
                                Kleidergrößen
                            </h2>
                        </div>
                        <div class="card__body">
                            <div class="form-row">
                                <div class="form-field">
                                    {{ form.kleider_oberteil.label(class="form-field__label") }}
                                    {{ form.kleider_oberteil(class="form-field__input") }}
                                    {% if form.kleider_oberteil.errors %}
                                    <span class="form-field__error">{{ form.kleider_oberteil.errors[0] }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="form-field">
                                    {{ form.kleider_hosen.label(class="form-field__label") }}
                                    {{ form.kleider_hosen(class="form-field__input") }}
                                    {% if form.kleider_hosen.errors %}
                                    <span class="form-field__error">{{ form.kleider_hosen.errors[0] }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-field">
                                {{ form.kleider_cap.label(class="form-field__label") }}
                                {{ form.kleider_cap(class="form-field__input") }}
                                {% if form.kleider_cap.errors %}
                                <span class="form-field__error">{{ form.kleider_cap.errors[0] }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Preferences Card -->
                    <div class="card">
                        <div class="card__header">
                            <h2 class="card__title">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                </svg>
                                Präferenzen
                            </h2>
                        </div>
                        <div class="card__body">
                            <div class="form-field">
                                {{ form.spirit_animal.label(class="form-field__label") }}
                                {{ form.spirit_animal(class="form-field__input") }}
                                {% if form.spirit_animal.errors %}
                                <span class="form-field__error">{{ form.spirit_animal.errors[0] }}</span>
                                {% endif %}
                            </div>
                            
                            <div class="form-field">
                                {{ form.fuehrerschein.label(class="form-field__label") }}
                                {{ form.fuehrerschein(class="form-field__input") }}
                                {% if form.fuehrerschein.errors %}
                                <span class="form-field__error">{{ form.fuehrerschein.errors[0] }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form Actions - Outside all cards -->
                    <div class="form-actions">
                        {{ form.submit(class="btn btn--primary") }}
                    </div>
                </form>
                </div>
                
                <!-- Tab 2: Sensible Daten -->
                <div class="tabs__panel {{ 'tabs__panel--active' if active_tab == 'sensitive' else '' }}"
                     role="tabpanel">
                    {% if sensitive_form %}
                    
                    <!-- Security Info Banner -->
                    <div class="alert alert--info">
                        <svg class="alert__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <div class="alert__content">
                            <div class="alert__title">Hinweis</div>
                            <div class="alert__message">
                                Diese Informationen werden verschlüsselt gespeichert.
                            </div>
                        </div>
                    </div>
                    
                    <form method="POST">
                        {{ sensitive_form.hidden_tag() }}
                        <input type="hidden" name="active_tab" value="sensitive">
                        
                        <!-- Reisepass Card -->
                        <div class="card">
                            <div class="card__header">
                                <h2 class="card__title">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                                    </svg>
                                    Reisepass
                                </h2>
                            </div>
                            <div class="card__body">
                                <div class="form-field">
                                    {{ sensitive_form.pass_nummer.label(class="form-field__label") }}
                                    {{ sensitive_form.pass_nummer(class="form-field__input") }}
                                    {% if sensitive_form.pass_nummer.errors %}
                                    <span class="form-field__error">{{ sensitive_form.pass_nummer.errors[0] }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-field">
                                        {{ sensitive_form.pass_ausgestellt.label(class="form-field__label") }}
                                        {{ sensitive_form.pass_ausgestellt(class="form-field__input", type="date") }}
                                        {% if sensitive_form.pass_ausgestellt.errors %}
                                        <span class="form-field__error">{{ sensitive_form.pass_ausgestellt.errors[0] }}</span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-field">
                                        {{ sensitive_form.pass_ablauf.label(class="form-field__label") }}
                                        {{ sensitive_form.pass_ablauf(class="form-field__input", type="date") }}
                                        {% if sensitive_form.pass_ablauf.errors %}
                                        <span class="form-field__error">{{ sensitive_form.pass_ablauf.errors[0] }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Personalausweis Card -->
                        <div class="card">
                            <div class="card__header">
                                <h2 class="card__title">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="2" y="6" width="20" height="12" rx="2"/>
                                        <circle cx="8" cy="12" r="2"/>
                                        <path d="M14 10h4M14 14h4"/>
                                    </svg>
                                    Personalausweis
                                </h2>
                            </div>
                            <div class="card__body">
                                <div class="form-field">
                                    {{ sensitive_form.id_nummer.label(class="form-field__label") }}
                                    {{ sensitive_form.id_nummer(class="form-field__input") }}
                                    {% if sensitive_form.id_nummer.errors %}
                                    <span class="form-field__error">{{ sensitive_form.id_nummer.errors[0] }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-field">
                                        {{ sensitive_form.id_ausgestellt.label(class="form-field__label") }}
                                        {{ sensitive_form.id_ausgestellt(class="form-field__input", type="date") }}
                                        {% if sensitive_form.id_ausgestellt.errors %}
                                        <span class="form-field__error">{{ sensitive_form.id_ausgestellt.errors[0] }}</span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-field">
                                        {{ sensitive_form.id_ablauf.label(class="form-field__label") }}
                                        {{ sensitive_form.id_ablauf(class="form-field__input", type="date") }}
                                        {% if sensitive_form.id_ablauf.errors %}
                                        <span class="form-field__error">{{ sensitive_form.id_ablauf.errors[0] }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Zusätzliche Informationen Card -->
                        <div class="card">
                            <div class="card__header">
                                <h2 class="card__title">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <polyline points="10 9 9 9 8 9"/>
                                    </svg>
                                    Zusätzliche Informationen
                                </h2>
                            </div>
                            <div class="card__body">
                                <div class="form-field">
                                    {{ sensitive_form.allergien.label(class="form-field__label") }}
                                    {{ sensitive_form.allergien(class="form-field__textarea", rows=3, placeholder="Allergien und wichtige medizinische Hinweise") }}
                                    {% if sensitive_form.allergien.errors %}
                                    <span class="form-field__error">{{ sensitive_form.allergien.errors[0] }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Form Actions - Outside all cards -->
                        <div class="form-actions">
                            {{ sensitive_form.submit(class="btn btn--primary") }}
                        </div>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
