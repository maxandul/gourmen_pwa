{% extends "base.html" %}

{% block title %}Sicherheit - Gourmen{% endblock %}

{% block content %}
<div class="container">
    <!-- Breadcrumbs -->
    <nav class="breadcrumbs" aria-label="Breadcrumb">
        <div class="breadcrumbs__item">
            <a href="{{ url_for('member.index') }}" class="breadcrumbs__link">Member</a>
            <span class="breadcrumbs__separator">/</span>
        </div>
        <div class="breadcrumbs__item">
            <span class="breadcrumbs__current">Sicherheit</span>
        </div>
    </nav>

    <div class="page-header">
        <h1>ğŸ”’ Sicherheit & 2FA</h1>
        <p class="page-subtitle">Verwalte deine Sicherheitseinstellungen</p>
    </div>
    
    <div class="page-content">
        <!-- 2FA Status Card -->
        <div class="card">
            <div class="card-header">
                <h2>ğŸ›¡ï¸ Zwei-Faktor-Authentifizierung</h2>
            </div>
            <div class="card-body">
                {% if current_user.mfa and current_user.mfa.is_totp_enabled %}
                <div class="card card-secondary variant-success">
                    <div class="card-header">
                        <h3>âœ… 2FA ist aktiviert</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-item">
                            <span class="label">Status:</span>
                            <span class="value">Aktiv</span>
                        </div>
                        <div class="stats-item">
                            <span class="label">Aktiviert am:</span>
                            <span class="value">{{ current_user.mfa.created_at.strftime('%d.%m.%Y %H:%M') if current_user.mfa.created_at else 'Unbekannt' }}</span>
                        </div>
                        
                        <div class="card-actions primary">
                            <a href="{{ url_for('auth.disable_2fa') }}" class="btn btn-danger">âŒ 2FA deaktivieren</a>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="card card-secondary variant-warning">
                    <div class="card-header">
                        <h3>âŒ 2FA ist nicht aktiviert</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-item">
                            <span class="label">Status:</span>
                            <span class="value">Nicht aktiv</span>
                        </div>
                        <div class="stats-item">
                            <span class="label">Sicherheit:</span>
                            <span class="value">Niedrig</span>
                        </div>
                        
                        <div class="card-actions primary">
                            <a href="{{ url_for('auth.enroll_2fa') }}" class="btn btn-primary">ğŸ” 2FA aktivieren</a>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Passwort Card -->
        <div class="card">
            <div class="card-header">
                <h2>ğŸ”‘ Passwort</h2>
            </div>
            <div class="card-body">
                <div class="card card-secondary variant-info">
                    <div class="card-header">
                        <h3>ğŸ”’ Passwort verwalten</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-item">
                            <span class="label">Letzte Ã„nderung:</span>
                            <span class="value">
                                {% if current_user.password_changed_at %}
                                    {{ current_user.password_changed_at.strftime('%d.%m.%Y %H:%M') }}
                                {% else %}
                                    Nie geÃ¤ndert
                                {% endif %}
                            </span>
                        </div>
                        <div class="stats-item">
                            <span class="label">Status:</span>
                            <span class="value">
                                {% if current_user.needs_password_change %}
                                    âš ï¸ Ã„nderung erforderlich
                                {% else %}
                                    âœ… Aktuell
                                {% endif %}
                            </span>
                        </div>
                        
                        <div class="card-actions primary">
                            <a href="{{ url_for('auth.change_password') }}" class="btn btn-primary">ğŸ”‘ Passwort Ã¤ndern</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Backup Codes Card -->
        {% if current_user.mfa and current_user.mfa.is_totp_enabled %}
        <div class="card">
            <div class="card-header">
                <h2>ğŸ” Backup-Codes</h2>
            </div>
            <div class="card-body">
                <div class="card card-secondary variant-warning">
                    <div class="card-header">
                        <h3>ğŸ“‹ Notfall-Zugang</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-item">
                            <span class="label">VerfÃ¼gbare Codes:</span>
                            <span class="value">{{ current_user.backup_codes|length if current_user.backup_codes else 0 }}</span>
                        </div>
                        <div class="stats-item">
                            <span class="label">Status:</span>
                            <span class="value">
                                {% if current_user.backup_codes and current_user.backup_codes|length > 0 %}
                                    âœ… VerfÃ¼gbar
                                {% else %}
                                    âŒ Nicht verfÃ¼gbar
                                {% endif %}
                            </span>
                        </div>
                        
                        <div class="card-actions primary">
                            <a href="{{ url_for('auth.backup_codes') }}" class="btn btn-warning">ğŸ“‹ Backup-Codes anzeigen</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Sicherheitshinweise Card -->
        <div class="card">
            <div class="card-header">
                <h2>â„¹ï¸ Sicherheitshinweise</h2>
            </div>
            <div class="card-body">
                <div class="card card-secondary variant-info">
                    <div class="card-header">
                        <h3>ğŸ›¡ï¸ Best Practices</h3>
                    </div>
                    <div class="card-body">
                        <ul class="security-tips">
                            <li>âœ… Verwende ein starkes, einzigartiges Passwort</li>
                            <li>âœ… Aktiviere 2FA fÃ¼r zusÃ¤tzliche Sicherheit</li>
                            <li>âœ… Speichere Backup-Codes sicher auf</li>
                            <li>âœ… Melde verdÃ¤chtige AktivitÃ¤ten sofort</li>
                            <li>âš ï¸ Teile niemals deine 2FA-Codes</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

