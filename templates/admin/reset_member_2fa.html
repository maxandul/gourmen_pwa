{% extends "base.html" %}
{% set use_v2_design = True %}

{% block title %}2FA zurücksetzen - Admin{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>
            <svg class="icon" aria-hidden="true"><use href="/static/icons/lucide-sprite.svg#shield-off"></use></svg>
            2FA zurücksetzen
        </h1>
        <p class="page-subtitle">Mitglied: {{ member.display_name_with_spirit }}</p>
    </div>
    
    <div class="page-content">
        <div class="card">
            <div class="card__header"><h2 class="card__title">Hinweis</h2></div>
            <div class="card__body">
                <div class="alert alert--warning">
                    <div class="alert__content">
                        <div class="alert__title">Wichtiger Hinweis</div>
                        <div class="alert__message">2FA wird deaktiviert, Backup-Codes gelöscht, erneute Einrichtung nötig. Aktion wird geloggt.</div>
                    </div>
                </div>

                <div class="card-section card-section--subtle">
                    <div class="card-section__header"><h3 class="card-section__title">Mitglied-Informationen</h3></div>
                    <div class="card-section__body">
                        <div class="info-row"><span class="info-row__label">Name</span><span class="info-row__value">{{ member.display_name_with_spirit }}</span></div>
                        <div class="info-row"><span class="info-row__label">E-Mail</span><span class="info-row__value">{{ member.email }}</span></div>
                        <div class="info-row"><span class="info-row__label">Status</span><span class="info-row__value">{% if member.is_active %}<span class="chip chip--success">Aktiv</span>{% else %}<span class="chip chip--danger">Inaktiv</span>{% endif %}</span></div>
                        <div class="info-row"><span class="info-row__label">Rolle</span><span class="info-row__value">{% if member.role.value == 'admin' %}<span class="chip chip--accent">Admin</span>{% else %}<span class="chip chip--info">Mitglied</span>{% endif %}</span></div>
                    </div>
                </div>

                <div class="card-section card-section--subtle">
                    <div class="card-section__header"><h3 class="card-section__title">Sicherheitsstatus</h3></div>
                    <div class="card-section__body" style="display:flex; gap: var(--space-3); align-items: center;">
                        {% set mfa_data = member.mfa_data %}
                        {% if mfa_data and mfa_data.is_totp_enabled %}
                            <span class="chip chip--success">2FA aktiviert</span>
                            <span class="text-muted">Aktiviert: {{ mfa_data.activated_at.strftime('%d.%m.%Y %H:%M') if mfa_data.activated_at else 'Unbekannt' }}</span>
                        {% else %}
                            <span class="chip chip--danger">2FA nicht aktiviert</span>
                            <span class="text-muted">Keine 2FA eingerichtet</span>
                        {% endif %}
                    </div>
                </div>

                <form method="POST" class="form" style="margin-top: var(--space-4);">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div class="form-field">
                        <label class="form-field__label" for="confirm">Bestätigung</label>
                        <input type="text" id="confirm" name="confirm" class="form-field__input" placeholder="Gib 'RESET' ein, um zu bestätigen" required>
                        <small style="color: var(--color-text-secondary);">Gib "RESET" ein, um 2FA zurückzusetzen.</small>
                    </div>
                    
                    <div class="form-actions" style="flex-wrap: wrap;">
                        <button type="submit" class="btn btn--danger" onclick="return confirm('2FA wirklich zurücksetzen?')">
                            <svg class="icon" aria-hidden="true"><use href="/static/icons/lucide-sprite.svg#shield-off"></use></svg>
                            2FA zurücksetzen
                        </button>
                        <a href="{{ url_for('admin.member_security_overview', member_id=member.id) }}" class="btn btn--outline">
                            <svg class="icon" aria-hidden="true"><use href="/static/icons/lucide-sprite.svg#arrow-left"></use></svg>
                            Abbrechen
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
