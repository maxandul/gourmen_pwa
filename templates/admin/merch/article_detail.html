{% extends "base.html" %}
{% set use_v2_design = True %}

{% block title %}{{ article.name }} - Details - Gourmen{% endblock %}

{% block content %}
<div class="container">
    <nav class="breadcrumbs" aria-label="Breadcrumb">
        <div class="breadcrumbs__item">
            <a href="{{ url_for('admin.merch') }}" class="breadcrumbs__link">Merch</a>
            <span class="breadcrumbs__separator">/</span>
        </div>
        <div class="breadcrumbs__item">
            <a href="{{ url_for('admin.merch', tab='articles') }}" class="breadcrumbs__link">Artikel</a>
            <span class="breadcrumbs__separator">/</span>
        </div>
        <div class="breadcrumbs__item">
            <span class="breadcrumbs__current">Artikel-Details</span>
        </div>
    </nav>

    <div class="page-header">
        <h1>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M21 16V8a2 2 0 0 0-1.106-1.789l-7-3.5a2 2 0 0 0-1.788 0l-7 3.5A2 2 0 0 0 3 8v8a2 2 0 0 0 1.106 1.789l7 3.5a2 2 0 0 0 1.788 0l7-3.5A2 2 0 0 0 21 16Z"/>
            </svg>
            {{ article.name }}
        </h1>
        <p class="page-subtitle">Artikel-Details und Varianten</p>
        <div class="page-actions">
            <a href="{{ url_for('admin.edit_merch_article', article_id=article.id) }}" class="btn btn--primary">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M12 20h9"/>
                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                </svg>
                Artikel bearbeiten
            </a>
            <a href="{{ url_for('admin.create_merch_variant', article_id=article.id) }}" class="btn btn--primary">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M12 5v14"/>
                    <path d="M5 12h14"/>
                </svg>
                Neue Variante
            </a>
        </div>
    </div>
    
    <div class="page-content">
        <!-- Artikel-Informationen -->
        <div class="card">
            <div class="card__header">
                <h2 class="card__title">Artikel-Informationen</h2>
                <div class="card__actions">
                    {% if article.is_active %}
                        <span class="chip chip--info">Aktiv</span>
                    {% else %}
                        <span class="chip chip--warning">Inaktiv</span>
                    {% endif %}
                </div>
            </div>
            <div class="card__body">
                <div class="info-row">
                    <span class="info-row__label">Name</span>
                    <span class="info-row__value">{{ article.name }}</span>
                    </div>
                <div class="info-row">
                    <span class="info-row__label">Beschreibung</span>
                    <span class="info-row__value">{{ article.description or 'Keine Beschreibung' }}</span>
                    </div>
                <div class="info-row">
                    <span class="info-row__label">Basis-Lieferantenpreis</span>
                    <span class="info-row__value">{{ "%.2f"|format(article.base_supplier_price_chf) }} CHF</span>
                    </div>
                <div class="info-row">
                    <span class="info-row__label">Basis-Mitgliederpreis</span>
                    <span class="info-row__value">{{ "%.2f"|format(article.base_member_price_chf) }} CHF</span>
                    </div>
                <div class="info-row">
                    <span class="info-row__label">Basis-Gewinn</span>
                    <span class="info-row__value">{{ "%.2f"|format(article.base_profit_chf) }} CHF</span>
                    </div>
                    {% if article.image_url %}
                <div class="info-row">
                    <span class="info-row__label">Bild-URL</span>
                    <span class="info-row__value">
                        <a href="{{ article.image_url }}" class="info-row__link" target="_blank">Öffnen</a>
                    </span>
                    </div>
                    {% endif %}
                <div class="info-row">
                    <span class="info-row__label">Erstellt am</span>
                    <span class="info-row__value">{{ article.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                    </div>
                <div class="info-row">
                    <span class="info-row__label">Aktualisiert am</span>
                    <span class="info-row__value">{{ article.updated_at.strftime('%d.%m.%Y %H:%M') if article.updated_at else '-' }}</span>
                </div>
            </div>
        </div>

        <!-- Varianten -->
        <div class="card">
            <div class="card__header">
                <h2 class="card__title">Varianten ({{ variants|length }})</h2>
                <div class="card__actions">
                    <a href="{{ url_for('admin.create_merch_variant', article_id=article.id) }}" class="btn btn--primary btn--sm">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M12 5v14"/>
                            <path d="M5 12h14"/>
                        </svg>
                        Neue Variante
                    </a>
                </div>
            </div>
            <div class="card__body">
                {% if variants %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Status</th>
                                    <th>Farbe</th>
                                    <th>Größe</th>
                                    <th>Lieferantenpreis</th>
                                    <th>Mitgliederpreis</th>
                                    <th>Gewinn</th>
                                    <th>Erstellt</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for variant in variants %}
                                <tr>
                                    <td>
                                        {% if variant.is_active %}
                                            <span class="chip chip--info">Aktiv</span>
                                        {% else %}
                                            <span class="chip chip--warning">Inaktiv</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ variant.color }}</td>
                                    <td>{{ variant.size }}</td>
                                    <td>{{ "%.2f"|format(variant.supplier_price_chf) }} CHF</td>
                                    <td>{{ "%.2f"|format(variant.member_price_chf) }} CHF</td>
                                    <td>{{ "%.2f"|format(variant.profit_chf) }} CHF</td>
                                    <td>{{ variant.created_at.strftime('%d.%m.%Y') }}</td>
                                    <td>
                                        <a href="{{ url_for('admin.edit_merch_variant', variant_id=variant.id) }}" class="btn btn--outline btn--sm">
                                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                                <path d="M12 20h9"/>
                                                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                                            </svg>
                                            Bearbeiten
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert--info">
                        <div class="alert__content">
                            <div class="alert__title">Noch keine Varianten</div>
                            <div class="alert__message">
                                Erstellen Sie Varianten mit verschiedenen Farben und Größen, um den Artikel bestellbar zu machen.
                            </div>
                        </div>
                    </div>
                    <div class="card__footer">
                        <a href="{{ url_for('admin.create_merch_variant', article_id=article.id) }}" class="btn btn--primary">
                            Erste Variante erstellen
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

    </div>
</div>
{% endblock %}

