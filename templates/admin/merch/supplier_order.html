{% extends "base.html" %}

{% block title %}Lieferanten-Bestellung - Gourmen{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>ğŸ“¦ Lieferanten-Bestellung</h1>
        <p class="page-subtitle">Ãœbersicht aller ausstehenden Bestellungen nach Artikel</p>
        <div class="page-actions">
            <a href="{{ url_for('admin.merch_orders') }}" class="btn btn-outline">â† ZurÃ¼ck zu Bestellungen</a>
        </div>
    </div>
    
    <div class="page-content">
        {% if pending_orders_count > 0 %}
            <!-- GesamtÃ¼bersicht -->
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ“Š Gesamtbestellung</h2>
                </div>
                <div class="card-body">
                    <div class="stats-grid">
                        <div class="stats-item">
                            <span class="label">Ausstehende Bestellungen:</span>
                            <span class="value">{{ pending_orders_count }}</span>
                        </div>
                        <div class="stats-item">
                            <span class="label">Artikel:</span>
                            <span class="value">{{ total_stats.article_count }}</span>
                        </div>
                        <div class="stats-item">
                            <span class="label">Varianten:</span>
                            <span class="value">{{ total_stats.variant_count }}</span>
                        </div>
                        <div class="stats-item">
                            <span class="label">GesamtstÃ¼ckzahl:</span>
                            <span class="value">{{ total_stats.total_quantity }} StÃ¼ck</span>
                        </div>
                        <div class="stats-item">
                            <span class="label">Lieferantenpreis:</span>
                            <span class="value">{{ "%.2f"|format(total_stats.total_supplier_price / 100) }} CHF</span>
                        </div>
                        <div class="stats-item">
                            <span class="label">Mitgliederpreis:</span>
                            <span class="value">{{ "%.2f"|format(total_stats.total_member_price / 100) }} CHF</span>
                        </div>
                        <div class="stats-item">
                            <span class="label">Gewinn:</span>
                            <span class="value profit">{{ "%.2f"|format(total_stats.total_profit / 100) }} CHF</span>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button onclick="copyToClipboard()" class="btn btn-primary">ğŸ“‹ Liste kopieren</button>
                        <form method="POST" action="{{ url_for('admin.mark_orders_as_shipped') }}" style="display: inline;" onsubmit="return confirm('Alle {{ pending_orders_count }} Bestellung(en) als \'Wird geliefert\' markieren?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-success">âœ… Als bestellt markieren</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Artikel-Liste -->
            <div class="events-list">
                {% for article_data in articles_data %}
                <div class="card card-secondary variant-accent">
                    <div class="card-header">
                        <h3>ğŸ·ï¸ {{ article_data.article.name }}</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-item">
                            <span class="label">GesamtstÃ¼ckzahl:</span>
                            <span class="value">{{ article_data.total_quantity }} StÃ¼ck</span>
                        </div>
                        <div class="stats-item">
                            <span class="label">Lieferantenpreis:</span>
                            <span class="value">{{ "%.2f"|format(article_data.total_supplier_price / 100) }} CHF</span>
                        </div>
                        
                        <div class="variant-divider"></div>
                        
                        {% for variant_data in article_data.variants %}
                        <div class="variant-item">
                            <div class="stats-item">
                                <span class="label"><strong>{{ variant_data.variant.color }}</strong> - {{ variant_data.variant.size }}</span>
                                <span class="value">{{ variant_data.quantity }} StÃ¼ck</span>
                            </div>
                            <div class="stats-item">
                                <span class="label">Bestellungen:</span>
                                <span class="value">{{ variant_data.order_count }}</span>
                            </div>
                            <div class="stats-item">
                                <span class="label">Preis (Lieferant):</span>
                                <span class="value">{{ "%.2f"|format(variant_data.supplier_price / 100) }} CHF</span>
                            </div>
                        </div>
                        {% if not loop.last %}
                        <div class="variant-separator"></div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
        {% else %}
            <div class="card">
                <div class="card-header">
                    <h2>Keine ausstehenden Bestellungen</h2>
                </div>
                <div class="card-body">
                    <div class="card card-secondary variant-info">
                        <div class="card-header">
                            <h3>âœ… Alles erledigt</h3>
                        </div>
                        <div class="card-body">
                            <p>Es gibt aktuell keine Bestellungen mit Status "Bestellt".</p>
                            <div class="card-actions primary">
                                <a href="{{ url_for('admin.merch_orders') }}" class="btn btn-outline">â† ZurÃ¼ck zu Bestellungen</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<!-- Hidden content for copy functionality -->
<textarea id="copy-content" style="position: absolute; left: -9999px;">{% if pending_orders_count > 0 %}ğŸ“¦ LIEFERANTEN-BESTELLUNG

ğŸ“Š GESAMTÃœBERSICHT
Ausstehende Bestellungen: {{ pending_orders_count }}
Artikel: {{ total_stats.article_count }}
Varianten: {{ total_stats.variant_count }}
GesamtstÃ¼ckzahl: {{ total_stats.total_quantity }} StÃ¼ck
Lieferantenpreis: {{ "%.2f"|format(total_stats.total_supplier_price / 100) }} CHF

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{% for article_data in articles_data %}ğŸ·ï¸ {{ article_data.article.name.upper() }}
{% for variant_data in article_data.variants %}{{ variant_data.variant.color }}, {{ variant_data.variant.size }}: {{ variant_data.quantity }} StÃ¼ck
{% endfor %}Artikel-Gesamt: {{ article_data.total_quantity }} StÃ¼ck ({{ "%.2f"|format(article_data.total_supplier_price / 100) }} CHF)

{% endfor %}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GESAMTPREIS: {{ "%.2f"|format(total_stats.total_supplier_price / 100) }} CHF
{% endif %}</textarea>

<script>
function copyToClipboard() {
    const textarea = document.getElementById('copy-content');
    textarea.select();
    textarea.setSelectionRange(0, 99999); // For mobile devices
    
    try {
        document.execCommand('copy');
        
        // Visual feedback
        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = 'âœ… Kopiert!';
        btn.disabled = true;
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }, 2000);
    } catch (err) {
        alert('Fehler beim Kopieren. Bitte manuell kopieren.');
    }
}
</script>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.action-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
}

/* Variant Divider */
.variant-divider {
    margin: 20px 0;
    border-top: 2px solid var(--card-border);
}

.variant-item {
    margin-bottom: 15px;
    padding-bottom: 15px;
}

.variant-separator {
    margin: 15px 0;
    border-top: 1px dashed var(--card-border);
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .variant-item {
        margin-bottom: 12px;
        padding-bottom: 12px;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .action-buttons .btn {
        width: 100%;
    }
}
</style>
{% endblock %}

