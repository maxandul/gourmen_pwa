{% extends "base.html" %}

{% block title %}Lieferanten-Bestellung - Gourmen{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>ğŸ“¦ Lieferanten-Bestellung</h1>
        <p class="page-subtitle">Ãœbersicht aller ausstehenden Bestellungen nach Artikel</p>
        <div class="page-actions">
            <a href="{{ url_for('admin.merch_orders') }}" class="btn btn-outline">â† ZurÃ¼ck zu Bestellungen</a>
            {% if pending_orders_count > 0 %}
            <button onclick="copyToClipboard()" class="btn btn-primary">ğŸ“‹ Liste kopieren</button>
            {% endif %}
        </div>
    </div>
    
    <div class="page-content">
        {% if pending_orders_count > 0 %}
            <!-- Artikel-Liste -->
            <div class="events-list">
                {% for article_data in articles_data %}
                <div class="card card-secondary variant-accent">
                    <div class="card-header">
                        <h3>ğŸ·ï¸ {{ article_data.article.name }}</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-item">
                            <span class="label">GesamtstÃ¼ckzahl:</span>
                            <span class="value">{{ article_data.total_quantity }} StÃ¼ck</span>
                        </div>
                        
                        <div class="variant-divider"></div>
                        
                        {% for variant_data in article_data.variants %}
                        <div class="stats-item">
                            <span class="label"><strong>{{ variant_data.variant.color }}</strong> - {{ variant_data.variant.size }}</span>
                            <span class="value">{{ variant_data.quantity }} StÃ¼ck</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
        {% else %}
            <div class="card">
                <div class="card-header">
                    <h2>Keine ausstehenden Bestellungen</h2>
                </div>
                <div class="card-body">
                    <div class="card card-secondary variant-info">
                        <div class="card-header">
                            <h3>âœ… Alles erledigt</h3>
                        </div>
                        <div class="card-body">
                            <p>Es gibt aktuell keine Bestellungen mit Status "Bestellt".</p>
                            <div class="card-actions primary">
                                <a href="{{ url_for('admin.merch_orders') }}" class="btn btn-outline">â† ZurÃ¼ck zu Bestellungen</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<!-- Hidden content for copy functionality -->
<textarea id="copy-content" style="position: absolute; left: -9999px;">{% if pending_orders_count > 0 %}ğŸ“¦ LIEFERANTEN-BESTELLUNG

ğŸ“Š GESAMTÃœBERSICHT
Ausstehende Bestellungen: {{ pending_orders_count }}
Artikel: {{ total_stats.article_count }}
Varianten: {{ total_stats.variant_count }}
GesamtstÃ¼ckzahl: {{ total_stats.total_quantity }} StÃ¼ck
Lieferantenpreis: {{ "%.2f"|format(total_stats.total_supplier_price / 100) }} CHF

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{% for article_data in articles_data %}ğŸ·ï¸ {{ article_data.article.name.upper() }}
{% for variant_data in article_data.variants %}{{ variant_data.variant.color }}, {{ variant_data.variant.size }}: {{ variant_data.quantity }} StÃ¼ck
{% endfor %}Artikel-Gesamt: {{ article_data.total_quantity }} StÃ¼ck ({{ "%.2f"|format(article_data.total_supplier_price / 100) }} CHF)

{% endfor %}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GESAMTPREIS: {{ "%.2f"|format(total_stats.total_supplier_price / 100) }} CHF
{% endif %}</textarea>

<script>
function copyToClipboard() {
    const textarea = document.getElementById('copy-content');
    textarea.select();
    textarea.setSelectionRange(0, 99999); // For mobile devices
    
    try {
        document.execCommand('copy');
        
        // Visual feedback
        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = 'âœ… Kopiert!';
        btn.disabled = true;
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }, 2000);
    } catch (err) {
        alert('Fehler beim Kopieren. Bitte manuell kopieren.');
    }
}
</script>

<style>
/* Variant Divider */
.variant-divider {
    margin: 20px 0;
    border-top: 2px solid var(--card-border);
}
</style>
{% endblock %}

